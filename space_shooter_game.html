<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/tone@13.8.25/build/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzicato/0.6.1/Pizzicato.min.js" integrity="sha512-t3Yc6vJCzfyNrKjNPhcG5V7IuknUYmjFof1CnNs3gJJybQEj9vql++Noi2L+DpD9STdcR5yNDXayT2DiHLAvrA==" crossorigin="anonymous"></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

        
    <style>
        body{
            overflow: hidden;
        }
        canvas{
            background-color: black;
            background:black;
            /* width:100vw;
            height:100vh; */
            position: fixed;
            z-index: 10;
            top:0;
            left:0
        }
        .game_console{
            position: fixed;
            z-index: 20;
            top:0;
            right: 0;
            color:lightgreen;
            font-family: monospace;
            height: 100px;
            overflow-y:scroll;
        }
    </style>
</head>


<body style="width:100%;">

<div style="width:100vw;height:100vh">

    <button style="position: fixed; top:0; left:0;z-index: 22; background: grey;" id="audio_context">no sound</button>

    <canvas id="game" >
    </canvas>
</div>


    <script type="module">



    //import {Tone} from "https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.15/Tone.js";
    import {Points_Object} from './Points_Object.js';
    import {Pixel_Drawer} from './Pixel_Drawer.js';
    import {Point_3_D}from './Point_3_D.js';
    import {Game_Object} from './Game_Object.js';
    import {Game} from './Game.js';
    
    window.g = new Game()
    var game = window.g;

    game.pixel_grid_width = 200;
    game.pixel_grid_height = 200;

    // now lets make a simple space shooter 
    game.spaceship = new Game_Object(
`
    x    
    x    
   xxx   
   xxx   
 x xxx x 
 x xxx x 
xxxx xxxx
    x   
   xxx  
    x   
`
);
    game.spaceship.name = "spaceship"
    game.spaceship.hue = 111;
    game.spaceship.position_point_3_d.x = 0;
    game.spaceship.position_point_3_d.y = 0;

    // we want to have a cool effect on
    // the last 4 points of points_object 
    // so we make use of the reference by 
    // filtering the points object and defining a
    // property named points_flame

    game.spaceship.points_flame = game.spaceship.points_object.points.slice(Math.max(game.spaceship.points_object.points.length - 5, 1))
    game.spaceship.points_flame_backwards = game.spaceship.points_object.points.filter(function(value, key){return [8,13, 12, 17].indexOf(key) != -1})
    game.spaceship.points_flame_rotation_left = game.spaceship.points_object.points.filter(function(value, key){return [18].indexOf(key) != -1})
    game.spaceship.points_flame_rotation_right = game.spaceship.points_object.points.filter(function(value, key){return [25].indexOf(key) != -1})

    // now the render funciton
    game.spaceship.rotation_speed = Math.PI * 2 / 1024;
    game.spaceship.movement_speed = 0.03;
    game.spaceship.movement_speed_backwards = 0.01;

    game.spaceship.flame_animation_for_points = function(points){
        
        // now we can make use of the 
        for(var key in points){
            // for fun we can set the brightness to random 
            points[key].brightness = Math.random();
            // and the hue +- 10 
            points[key].hue  = 50 + (Math.random()-0.5) * 50
        }
    }
    game.spaceship.hide_points = function(points){
        // now we can make use of the 
        for(var key in points){
            //"cooldown" 
            points[key].brightness = Math.max(0, points[key].brightness-0.1);
        }
    }

    game.spaceship.render_function = function(){

        /**
         * 
         * left = 37
         * up = 38
         * right = 39
         * down = 40
         * spacebar = 32
        **/

        if (game.keydownsups["keyCode_37"].down) {
            // i dont know what axis this is , depends on the view of the game , in a top down shooter it could be the yaw axis... just using x for now
            this.rotation_velocity_point_3_d.x -= this.rotation_speed;
            
            this.flame_animation_for_points(this.points_flame_rotation_left);

        }else{
            this.hide_points(this.points_flame_rotation_left)
        }

        if (game.keydownsups["keyCode_38"].down) {
            
            //some fancy math for the movement direction wich is depending on the rotation
            this.position_velocity_point_3_d.x -= (Math.sin((Math.PI * 2) - this.rotation_point_3_d.x))* this.movement_speed;
            this.position_velocity_point_3_d.y -= (Math.cos(this.rotation_point_3_d.x))* this.movement_speed;

            // now we can make use of the 
            this.flame_animation_for_points(this.points_flame);

        }else{
            //hide the flame points if arrow up not pressed
            this.hide_points(this.points_flame);
        }
        if (game.keydownsups["keyCode_39"].down) {
            //this.position_velocity_point_3_d.x += this.movement_speed;
            this.rotation_velocity_point_3_d.x += this.rotation_speed;

            // now we can make use of the 
            this.flame_animation_for_points(this.points_flame_rotation_right);

        }else{
            this.hide_points(this.points_flame_rotation_right)
        }
        if (game.keydownsups["keyCode_40"].down) {
            //some fancy math for the movement direction wich is depending on the rotation
            
            this.position_velocity_point_3_d.x += (Math.sin((Math.PI * 2) - this.rotation_point_3_d.x))* this.movement_speed_backwards;
            this.position_velocity_point_3_d.y += (Math.cos(this.rotation_point_3_d.x))* this.movement_speed_backwards;

            // now we can make use of the 
            this.flame_animation_for_points(this.points_flame_backwards);

        }else{
            this.hide_points(this.points_flame_backwards)
        }

        if (game.keydownsups["keyCode_32"].down) {
            //this.scale_point_3_d.x +=0.1;
            //spawn_asteroid();
            //this.shoot();
        }
        // prevent this from getting out of the screen
        this.position_point_3_d.x = this.position_point_3_d.x % (game.pixel_grid_width/2);
        this.position_point_3_d.y = this.position_point_3_d.y % (game.pixel_grid_height/2);

    }
    


    

    game.start_rendering();

    </script>



</body>
</html>